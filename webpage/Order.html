<!DOCTYPE html>
<html>
<head>
<!--bootstrap-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<!--css-->
<link href="css/page.css" rel="stylesheet">

<title>海大拍賣訂單頁</title>
<style>
  div.borderup{
    position:relative;
    top:0px;
    height:80px;
    background-color: #3949AB;
  }
  div.border{
    position:relative;
    top:100px;
    margin-left:380px;
    width:850px;
    height:700px;
   
    border-style:solid;
    border-width: 20px;
    border-color:blue;

    background-color:rgb(172, 70, 70);
    padding-left:20px;
    padding-top:20px;
    
  }
  p{
    font-size:20px;

  }
  table,th,td {
    
    border-collapse:collapse;
    margin-left:10px;
    font-size: 40px;
  }
  #div1{/*商品價個數量*/
    float:left;
     margin-top: 5px;
    margin-bottom: 5px;
    margin-right: 30px;
    margin-left: 40px;
    color:black;
    font-size:24px;
  }
  #div2{
    position: relative;
    top: 5px;
    background-color:blanchedalmond;
    border:3px solid #000;
    width:800px;
    height:100px;
    padding-left: 10px;
    margin-left:0px;
    margin-top:10px;
    float:left;
  }
  #div3{
    font-weight:bold;
        font-size:27px;
        color:#3949AB;
        width:680px;
        height:30px;
        padding-left:40px; 
        padding-right:75px;
       float:left;
  }
  #div4{
    font-weight:bold;
        font-size:30px;
        color:#3949AB;
        height:30px;
        margin-right:0px;
        margin-top:10px;
    float:right;
  }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>


<link rel="stylesheet" href="assets/css/fontawesome.css">
<link rel="stylesheet" href="assets/css/templatemo-sixteen.css">
<link rel="stylesheet" href="assets/css/owl.css">
<link rel="stylesheet" href="assets/css/dialog.css">
<script type="text/javascript">


//以下為userlist點開清單的顯示
var VisibleMenu = ''; // 記錄目前顯示的子選單的 ID

// 顯示或隱藏子選單
function switchMenu( theMainMenu, theSubMenu, theEvent ){
    var SubMenu = document.getElementById( theSubMenu );
    if( SubMenu.style.display == 'none' ){ // 顯示子選單
        SubMenu.style.minWidth = theMainMenu.clientWidth; // 讓子選單的最小寬度與主選單相同 (僅為了美觀)
        SubMenu.style.display = 'inline';
        hideMenu(); // 隱藏子選單
        VisibleMenu = theSubMenu;
    }
    else{ // 隱藏子選單
        if( theEvent != 'MouseOver' || VisibleMenu != theSubMenu ){
            SubMenu.style.display = 'none';
            VisibleMenu = '';
        }
    }
}

// 隱藏子選單
function hideMenu(){
    if( VisibleMenu != '' ){
        document.getElementById( VisibleMenu ).style.display = 'none';
    }
    VisibleMenu = '';
}
function dele(id){
    alert(id);
    var str = "/backend/order/del?pdid="+id;
    var request=new XMLHttpRequest;
    request.open("get",str);
    request.onreadystatechange = function() { 
        if (request.readyState === 4 && request.status === 200) {
        var type = request.getResponseHeader("Content-Type");
        if (type.match(/^text/)){ // Make sure response is text
        alert("success to delete");
        window.location.href="Order.html";
      }
    }
    }
    request.send(null);

    

}
function addhis(id){
    var request2=new XMLHttpRequest;
    var str2 = "/backend/history/add?pdid="+id;
    request2.open("get",str2);
    request2.onreadystatechange = function() { 
        if (request2.readyState === 4 && request2.status === 200) {
        var type = request2.getResponseHeader("Content-Type");
        if (type.match(/^text/)){ // Make sure response is text
        
      }
    }
    }
    request2.send(null);
}
//以下是搜尋商品的function，目前無圖片及連結
window.onload=getProductOrder;
function getProductOrder(){

//var msg="https://cors-anywhere.herokuapp.com/https://ntou-sell.herokuapp.com/product/search?";

var msg="backend/order/get";

var request=new XMLHttpRequest;
request.open("get",msg); 

  request.onreadystatechange = function() { // Define event listener
  // If the request is complete and was successful
    if (request.readyState === 4 && request.status === 200) {
      var type = request.getResponseHeader("Content-Type");
      if (type.match(/^text/)){ // Make sure response is text
		var datastr = JSON.parse(request.responseText);
		var len  = datastr.length;
    var searchResult="";
   // var strbutt=<button type="button" onclick="changeSta()" style="width:30px;height:20px">Change</button>
		for (var i = 0; i < len; i++) {
      var content = 
      '<div id="div2">'+
      '<div id="div3">'+
        
      +datastr[i].Pdid+'&nbsp;&emsp;'+datastr[i].PdName+'&nbsp;&emsp;'+datastr[i].Price+'&nbsp;&emsp;'+datastr[i].Amount+'&nbsp;&emsp;'+datastr[i].Eval+
                
      '</div>'+
      '<div id="div4">'+
      '<input type="button" style="font-size:4px;width:40px;height:30px;margin-right:10px;" id="box1" name="button2" value="更改">'+
      ' <button type="button"  id="rt" style="width:40px;height:30px;font-size:10px;background-color:#3949AB;margin-right:10px;" onclick="">'+"說個話"+'</button>'+
      ' <button type="button" id="'+datastr[i].Pdid+'" style="width:40px;height:30px;font-size:10px;background-color:#3949AB;margin-right:10px;" onclick="addhis(this.id);dele(this.id);">'+"完成"+'</button>'+
      '</div>'+
      '</div>';
    
			searchResult=searchResult+content;
		
		};
		document.getElementById("NP").innerHTML=searchResult;
      }
    }
  };
request.send(null);

}

$(document).ready(function(){
  $("#rt").click(function(){
  $("#if").toggle();
  });
});
//logout的功能
function logout(){
localStorage.clear();


var logoutRequest=new XMLHttpRequest;
logoutRequest.open("get","backend/user/logout"); 

  logoutRequest.onreadystatechange = function() { // Define event listener
  // If the request is complete and was successful
    if (logoutRequest.readyState === 4 && logoutRequest.status === 200) {
    alert("帳號登出!");
    window.location.href="index.html";
	}
  }
logoutRequest.send(null);

//alert("帳號登出!");
//測試用 console.log(localStorage.getItem("account"));
//window.location.href="index.html";
}

var me = {};
me.avatar = "https://lh6.googleusercontent.com/-lr2nyjhhjXw/AAAAAAAAAAI/AAAAAAAARmE/MdtfUmC0M4s/photo.jpg?sz=48";

var you = {};
you.avatar = "https://a11.t26.net/taringa/avatares/9/1/2/F/7/8/Demon_King1/48x48_5C5.jpg";

function formatAMPM(date) {
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0'+minutes : minutes;
    var strTime = hours + ':' + minutes + ' ' + ampm;
    return strTime;
}            

//-- No use time. It is a javaScript effect.
function insertChat(who, text, time){
    if (time === undefined){
        time = 0;
    }
    var control = "";
    var date = formatAMPM(new Date());
    
    if (who == "me"){
        control = '<li style="width:100%">' +
                        '<div class="msj macro">' +
                        '<div class="avatar"><img class="img-circle" style="width:100%;" src="'+ me.avatar +'" /></div>' +
                            '<div class="text text-l">' +
                                '<p>'+ text +'</p>' +
                                '<p><small>'+date+'</small></p>' +
                            '</div>' +
                        '</div>' +
                    '</li>';                    
    }else{
        control = '<li style="width:100%;">' +
                        '<div class="msj-rta macro">' +
                            '<div class="text text-r">' +
                                '<p>'+text+'</p>' +
                                '<p><small>'+date+'</small></p>' +
                            '</div>' +
                        '<div class="avatar" style="padding:0px 0px 0px 10px !important"><img class="img-circle" style="width:100%;" src="'+you.avatar+'" /></div>' +                                
                  '</li>';
    }
    setTimeout(
        function(){                        
            $("#dia").append(control).scrollTop($("#dia").prop('scrollHeight'));
        }, time);

}

function resetChat(){
    $("#dia").empty();
}

$(".mytext").on("keydown", function(e){
    if (e.which == 13){
        var text = $(this).val();
        if (text !== ""){
            insertChat("me", text);              
            $(this).val('');
        }
    }
});

$('body > div > div > div:nth-child(2) > span').click(function(){
    $(".mytext").trigger({type: 'keydown', which: 13, keyCode: 13});
})

//-- Clear Chat
resetChat();

//-- Print Messages
insertChat("me", "Hello Tom...", 0);  
insertChat("you", "Hi, Pablo", 1500);
insertChat("me", "What would you like to talk about today?", 3500);
insertChat("you", "Tell me a joke",7000);
insertChat("me", "Spaceman: Computer! Computer! Do we bring battery?!", 9500);
insertChat("you", "LOL", 12000);

function getmessg(){

var newProduct='';
var request=new XMLHttpRequest;

request.open("get","/backend/message/get?remoteUID=2&ascend=true");
request.onreadystatechange = function() { 
    if (request.readyState === 4 && request.status === 200) {
        var type = request.getResponseHeader("Content-Type");
        if (type.match(/^text/)){ // Make sure response is text
        var datastr = JSON.parse(request.responseText);
        var len  = datastr.Content;
        
        alert(datastr.Content[0].Status);
        for(var i=0;i<len;i++){
          if(datastr.Content[i].Status=="s")insertChat("me",datastr.Content[i].Text,0);
          if(datastr.Content[i].Status=="r")insertChat("you",datastr.Content[i].Text,0);
        }
        
        

        }
    }

};
request.send(null);

}
function sendmessg(){
  var dialo = document.getElementById("message");
  alert(dialo.value);
  insertChat("me",dialo.value,20000);
  var content = "/backend/message/send?";
  content=content+"remoteUID="+"2"+"&text="+dialo.value;

  var request=new XMLHttpRequest;
  request.open("get",content);
  request.onreadystatechange = function() { 
      if (request.readyState === 4 && request.status === 200) {
          var type = request.getResponseHeader("Content-Type");
          alert("success");
      }
      else{
        alert("not success");
      }
  };
  request.send(null);
}
</script>


</head>

<body style="margin:0px; padding:0px; background:#fff url(img/bg2.webp) center center fixed no-repeat;background-size:cover; display:block;">
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="true
      " aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
        
      <a class="navbar-brand" href="MainPage.html"><h2>海大購物 <em>Shop</em></h2></a>
      
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="MainPage.html">Home
              <span class="sr-only">(current)</span>
            </a>
          </li> 
          <li class="nav-item">
            <a class="nav-link" href="Cart.html">Cart</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="History.html">History</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Sell.html">Sell</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="Order.html">Order</a>
          </li>

        </ul>
      </div>
    </div>
  </nav>
  <div id="if">这是一个段落。</div>
  <div class = "border">
    <h2>Order</h2>
    <div style="padding-left:20px">
    <div class= "borderup">
      <div id="div1">order id</div>
      <div id="div1">Name</div>
      <div id="div1">Price</div>
      <div id="div1">數量</div>
      <div id="div1">State</div>
      
    </div>
    <br>
    <div style="margin-left:0px;">
      <table id=NP width="1000" height="800">
        <tr><td>
        </td></tr>
          
      </table> 
    
      </div>
      <!--below show dialog-->
      <div id = "show">
      <div class="col-sm-3 col-sm-offset-4 frame" >
        <ul id="dia"></ul>
        <div>
            <div class="msj-rta macro">                        
                <div class="text text-r" style="background:whitesmoke !important">
                    
                    <input name="message" type="text" class="mytext" id="message"  name="message" placeholder="Type a message"/>
                    

                </div> 

            </div>
            <div style="padding:10px;">
                <button type="button" onclick="sendmessg()">傳送</button>
                <button type="button" onclick="getmessg()">接</button>
            </div>                
        </div>
    </div>
    </div>
    <script src="assets/js/dialog.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="jquery/jquery.min.js"></script>
    </div>
  
  </div>
</body>

</html>
